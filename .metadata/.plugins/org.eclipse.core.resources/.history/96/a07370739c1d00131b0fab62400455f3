package laundrylist.controller;

import laundrylist.model.JSONController;
import laundrylist.model.JSONController.JSONRequest;
import laundrylist.model.State;
import laundrylist.view.ExploreActivity;
import laundrylist.view.LoginActivity;
import android.content.Intent;
import android.os.AsyncTask;
import android.util.Log;
import android.widget.Toast;

public class LoginController extends Controller {
	private LoginActivity view;
	private JSONController json;

	public LoginController(LoginActivity activity) {
		this.view = activity;
		json = new JSONController(this);
	}

	public void onLoginPressed(String username, String password) {
		Object[] data = new Object[2];

		// data[0] = "jason.haury@gmail.com";
		// data[1] = "asdf";

		data[0] = username;
		data[1] = password;
		new LoginTask().execute(data);
	}

	private class LoginTask extends AsyncTask<Object[], Void, String> {

		@Override
		protected String doInBackground(Object[]... params) {
			// TODO Auto-generated method stub
			json.request(JSONRequest.LOGIN, params[0]);
			return "";
		}

		@Override
		protected void onPostExecute(String result) {
			// do something
			if (result.equals("")) {
				view.startActivity(new Intent(view, ExploreActivity.class));
				view.finish();
			} else {
				int duration = Toast.LENGTH_SHORT;

				Toast toast = Toast.makeText(view, result, duration);
				toast.show();
			}
		}

	}

	@Override
	public void onJSONReceived(JSONObject jsonObject) {
		Log.i(LoginController.class.getName(), jsonObject.getString("id"));
		Log.i(LoginController.class.getName(), jsonObject.getString("name"));
	}
}
